from fastapi.testclient import TestClient
from app import app

client = TestClient(app)

def test_health_check():
    response = client.get("/health")
    assert response.status_code == 200
    assert response.json() == {"status": "ok"}


def test_predict_endpoint():
    # Like
    sample_input = {"x1":267.4745178223,
                    "y1":427.7293188572,
                    "z1":-0.000000087,
                    "x2":260.0076828003,
                    "y2":410.6356827021,
                    "z2":0.0030155303,
                    "x3":248.8552093506,
                    "y3":397.3338725567,
                    "z3":-0.0004125527,
                    "x4":241.9359512329,
                    "y4":385.5021586418,
                    "z4":-0.0056092744,
                    "x5":240.8134231567,
                    "y5":374.2707016468,
                    "z5":-0.0118469065,
                    "x6":232.1887664795,
                    "y6":403.421554327,
                    "z6":-0.0017941096,
                    "x7":226.2967529297,
                    "y7":408.4741737843,
                    "z7":-0.0050739567,
                    "x8":231.8649215698,
                    "y8":411.1318595409,
                    "z8":-0.011127797,
                    "x9":237.0368041992,
                    "y9":411.6173211336,
                    "z9":-0.0160331391,
                    "x10":229.9305267334,
                    "y10":413.6058626175,
                    "z10":-0.0066573559,
                    "x11":227.8861541748,
                    "y11":418.6288501024,
                    "z11":-0.0048440099,
                    "x12":233.5857467651,
                    "y12":419.6872218847,
                    "z12":-0.0074542118,
                    "x13":239.0633010864,
                    "y13":419.6389524937,
                    "z13":-0.0119513627,
                    "x14":230.9145126343,
                    "y14":424.0656187534,
                    "z14":-0.0106252106,
                    "x15":230.5740966797,
                    "y15":426.8744859695,
                    "z15":-0.0088771675,
                    "x16":235.8167495728,
                    "y16":426.8511257172,
                    "z16":-0.007905812,
                    "x17":241.2709579468,
                    "y17":426.2536110878,
                    "z17":-0.0096588237,
                    "x18":233.0195159912,
                    "y18":433.0810003281,
                    "z18":-0.0145546123,
                    "x19":233.9047164917,
                    "y19":434.3691658974,
                    "z19":-0.0135101853,
                    "x20":239.3723831177,
                    "y20":433.9881398678,
                    "z20":-0.0098457206,
                    "x21":244.051574707,
                    "y21":433.1285841465,
                    "z21":-0.0072380137}
    
    response = client.post("/predict", json=sample_input)
    assert response.status_code == 200
    assert "prediction" in response.json()
    assert "gesture_name" in response.json()